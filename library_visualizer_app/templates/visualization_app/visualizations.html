{% extends 'visualization_app/base.html' %}
{% load static %}

{% block app %}
<div class="card">

<link href="http://cdn.pydata.org/bokeh/release/bokeh-0.12.14.min.css" rel="stylesheet" type="text/css">
<link href="http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.14.min.css" rel="stylesheet" type="text/css">

    <div class="card-header">
        <h3 style="margin: 0;"><a href="{% url 'index' %}" style="display:inline-block;">
        <img src="{% static 'open-iconic/svg/arrow-thick-left.svg' %}" alt='back arrow' style="height: 36px; margin: auto;"></a>
        LibHub</h3>
    </div>

    {% for visualization in visualizations %}
    {% if forloop.first %}
    <div id="{{visualization.0}}" class="mx-auto card-body" style="display: Block; width: 500px;">
    {% else %}
    <div id="{{visualization.0}}" class="mx-auto card-body" style="display: None; width: 500px;">
    {% endif %}
        <div style="text-align: center;">
            This is the visualization page for {{visualization.0}}.
        </div>
        <div style="text-align: center;">
            I can't center this stupid graph below me! Wtf!
        </div>

        <div style="margin: auto;">
            {{ visualization.2 | safe }}
        </div>
            {{ visualization.1 | safe }}


        <script src="http://cdn.pydata.org/bokeh/release/bokeh-0.12.14.min.js"></script>
        <script src="http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.14.min.js"></script>

    </div>
    {% endfor %}

    <div class="card-footer" style="padding:5px;">
        <img src="{% static 'open-iconic/svg/chevron-left.svg' %}" alt='left arrow' class="scroller scroller-left">
        <img src="{% static 'open-iconic/svg/chevron-right.svg' %}" alt='right arrow' class="scroller scroller-right">
        <div class="wrapper">
            <ul class="nav nav-tabs list">
                {% for visualization in visualizations %}
                <li class="small">
                    {% if forloop.first %}
                    <a class="nav-link active" id="nav{{visualization.0}}" href="#" onclick="changeNav('{{visualization.0}}')">{{visualization.0}}</a>
                    {% else %}
                    <a class="nav-link" id="nav{{visualization.0}}" href="#" onclick="changeNav('{{visualization.0}}')">{{visualization.0}}</a>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

<!-- Scroller JS and CSS from https://www.bootply.com/l2ChB4vYmC , with modification -->

<style>
    .wrapper {
        position:relative;
        margin:0 auto;
        overflow:hidden;
        padding:5px;
        height:30px;
    }

    .list {
        position:absolute;
        left:0px;
        top:0px;
        min-width:3000px;
        margin-left:12px;
        margin-top:0px;
    }

    .list li{
        display:table-cell;
        position:relative;
        text-align:center;
        cursor:grab;
        cursor:-webkit-grab;
        color:#efefef;
        vertical-align:middle;
    }

    .scroller {
        text-align:center;
        cursor:pointer;
        display:none;
        padding:10px;
        padding-top:11px;
        white-space:no-wrap;
        vertical-align:middle;
    }

    .scroller-right{
        float:right;
    }

    .scroller-left {
        float:left;
    }
</style>
<script>
    function changeNav(id) {
        document.getElementById(id).style.display = "Block";
        document.getElementById("nav"+id).classList.add("active");
        let visualization_names = ["Popularity Count", "Release Frequency", "Last Modified Date",
        "Backwards Compatibility", "Stack Overflow", "Security & Performance", "Issue Data Response Time", "Issue Data Resolved Time"];
        for (let index = 0; index < visualization_names.length; index++) {
            if (visualization_names[index] != id){
                try {
                    document.getElementById(visualization_names[index]).style.display = "None";
                    document.getElementById("nav"+visualization_names[index]).classList.remove("active");
                }
                catch(err){
                    console.log(visualization_names[index] + " is not in navbar footer")
                }
            }      
        }
    }
    
    var hidWidth;
    var scrollBarWidths = 40;

    var widthOfList = function(){
    var itemsWidth = 0;
    $('.list li').each(function(){
        var itemWidth = $(this).outerWidth();
        itemsWidth+=itemWidth;
    });
    return itemsWidth;
    };

    var widthOfHidden = function(){
    return (($('.wrapper').outerWidth())-widthOfList()-getLeftPosi())-scrollBarWidths;
    };

    var getLeftPosi = function(){
    return $('.list').position().left;
    };

    var reAdjust = function(){
    if (($('.wrapper').outerWidth()) < widthOfList()) {
        $('.scroller-right').show();
    }
    else {
        $('.scroller-right').hide();
    }
    
    if (getLeftPosi()<0) {
        $('.scroller-left').show();
    }
    else {
        $('.item').animate({left:"-="+getLeftPosi()+"px"},'slow');
        $('.scroller-left').hide();
    }
    }
    document.addEventListener("DOMContentLoaded", function() {
        reAdjust();
    });

    $(window).on('resize',function(e){  
        reAdjust();
    });

    $('.scroller-right').click(function() {
    
    $('.scroller-left').fadeIn('slow');
    $('.scroller-right').fadeOut('slow');
    
    $('.list').animate({left:"+="+widthOfHidden()+"px"},'slow',function(){

    });
    });

    $('.scroller-left').click(function() {
    
        $('.scroller-right').fadeIn('slow');
        $('.scroller-left').fadeOut('slow');
    
        $('.list').animate({left:"-="+getLeftPosi()+"px"},'slow',function(){
        
        });
    });

    </script>

{% endblock %}